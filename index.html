<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>copypasta</title>
</head>
<body>
    <pre>
ProductID,UserID,Rating,ReviewText
P1,U1,4,Good quality product and fast delivery
P1,U2,5,Excellent product very durable
P1,U3,3,Average quality delivery was late
P1,U4,2,Poor packaging and slow delivery
P1,U5,5,Very durable excellent value for money
P1,U6,4,Good product reliable and affordable

P2,U7,3,Average quality delivery was late
P2,U8,2,Poor quality not recommended
P2,U9,4,Decent product value for money
P2,U10,1,Very poor build quality completely useless
P2,U11,3,Okay product but delivery was slow
P2,U12,5,Excellent quality durable and reliable

P3,U13,5,Excellent superb quality
P3,U14,4,Good product sturdy and reliable
P3,U15,5,Durable product excellent build
P3,U16,3,Average item not as expected
P3,U17,2,Poor finish and not durable
P3,U18,4,Good value product fast delivery

P4,U19,5,Excellent laptop very fast and reliable
P4,U20,4,Good performance durable and sleek
P4,U1,5,Superb product excellent build quality
P4,U2,3,Average laptop heating issue sometimes
P4,U3,4,Good quality and smooth performance
P4,U4,2,Poor battery life not recommended

P5,U5,3,Average phone decent but not great
P5,U6,4,Good product with fast delivery
P5,U7,5,Excellent phone very durable and smooth
P5,U8,2,Poor performance and heating issues
P5,U9,4,Good value for money
P5,U10,5,Superb phone excellent features

P6,U11,5,Excellent headphones superb sound quality
P6,U12,4,Good sound comfortable to wear
P6,U13,3,Average product nothing special
P6,U14,2,Poor build quality not durable
P6,U15,4,Good bass and clear sound
P6,U16,5,Excellent value very durable headphones

avg_rating_mapper.py

#!/usr/bin/env python
from __future__ import print_function
import sys
import csv

reader = csv.reader(sys.stdin)
for row in reader:
    if not row or len(row) < 4:
        continue
    if row[0].lower() == 'productid':
        continue
    product = row[0].strip()
    try:
        rating = float(row[2].strip())
    except:
        continue
    # emit product and rating
    print("{0}\t{1}".format(product, rating))

avg_rating_reducer.py

#!/usr/bin/env python
from __future__ import print_function
import sys

current_product = None
sum_ratings = 0.0
count = 0

for line in sys.stdin:
    parts = line.strip().split("\t")
    if len(parts) != 2:
        continue
    product, val = parts
    try:
        rating = float(val)
    except:
        continue
    if product == current_product:
        sum_ratings += rating
        count += 1
    else:
        if current_product is not None:
            avg = sum_ratings / count
            print("{0}\t{1:.2f}".format(current_product, avg))
        current_product = product
        sum_ratings = rating
        count = 1

# final product
if current_product is not None and count > 0:
    avg = sum_ratings / count
    print("{0}\t{1:.2f}".format(current_product, avg))


chmod +x ~/avg_rating_mapper.py ~/avg_rating_reducer.py

keyword_mapper.py

#!/usr/bin/env python
from __future__ import print_function
import sys
import csv
import re

stopwords = set(["the","and","is","was","very","not","a","an","to","of"])

reader = csv.reader(sys.stdin)
for row in reader:
    if not row or len(row) < 4:
        continue
    if row[0].lower() == 'productid':
        continue
    review = row[3].lower()
    words = re.findall(r"[a-z]+", review)
    for w in words:
        if w in stopwords:
            continue
        print("{0}\t1".format(w))


keyword_reducer.py


#!/usr/bin/env python
from __future__ import print_function
import sys

current_word = None
count = 0

for line in sys.stdin:
    parts = line.strip().split("\t")
    if len(parts) != 2:
        continue
    word, val = parts
    try:
        v = int(val)
    except:
        continue
    if word == current_word:
        count += v
    else:
        if current_word is not None:
            print("{0}\t{1}".format(current_word, count))
        current_word = word
        count = v

if current_word is not None:
    print("{0}\t{1}".format(current_word, count))


chmod +x ~/keyword_mapper.py ~/keyword_reducer.py

Local Tests

# Average rating test
cat ~/reviews.txt | ./avg_rating_mapper.py | sort | ./avg_rating_reducer.py

# Keyword frequency test
cat ~/reviews.txt | ./keyword_mapper.py | sort | ./keyword_reducer.py | sort -k2 -nr | head -10


If HDFS is working (safe mode left), run:

# Upload dataset
hdfs dfs -mkdir -p /user/$(whoami)/reviews_in
hdfs dfs -put -f ~/reviews.txt /user/$(whoami)/reviews_in/

STREAMING_JAR=$(ls /usr/lib/hadoop-mapreduce/hadoop-streaming*.jar | head -n1)

# Average rating job
hdfs dfs -rm -r /user/$(whoami)/avg_out 2>/dev/null
hadoop jar $STREAMING_JAR \
  -files ~/avg_rating_mapper.py,~/avg_rating_reducer.py \
  -mapper avg_rating_mapper.py -reducer avg_rating_reducer.py \
  -input /user/$(whoami)/reviews_in/reviews.txt \
  -output /user/$(whoami)/avg_out

hdfs dfs -cat /user/$(whoami)/avg_out/part-00000

# Keyword frequency job
hdfs dfs -rm -r /user/$(whoami)/kw_out 2>/dev/null
hadoop jar $STREAMING_JAR \
  -files ~/keyword_mapper.py,~/keyword_reducer.py \
  -mapper keyword_mapper.py -reducer keyword_reducer.py \
  -input /user/$(whoami)/reviews_in/reviews.txt \
  -output /user/$(whoami)/kw_out

hdfs dfs -cat /user/$(whoami)/kw_out/part-00000 | sort -k2 -nr | head -10

    </pre>
</body>
</html>